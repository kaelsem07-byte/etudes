<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programme d'Étude Interactif - P1: Contrôle et Traitement Comptable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f0f2f5;
            background-image: linear-gradient(to top right, #a855f7, #3b82f6);
        }

        /* Style Glassmorphism */
        .glass-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1rem; /* 16px */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .glass-button, .tab-button {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: rgba(255, 255, 255, 0.6);
            color: #1e3a8a; /* blue-900 */
            font-weight: 600;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .ai-feedback, .chat-message {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
        }

        /* Scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.6);
        }
        
        .prose h2 { margin-top: 1.5em; margin-bottom: 0.5em; }
        .prose h3 { margin-top: 1.2em; margin-bottom: 0.4em; }
        
        /* Spinner */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Chat Modal */
        #aiTutorModal {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="min-h-screen text-gray-800 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="glass-card p-6 mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white text-center">Processus 1 : Contrôle et Traitement Comptable des Opérations Commerciales</h1>
        </header>

        <main>
            <!-- Navigation par onglets -->
            <div id="tab-navigation" class="flex flex-wrap justify-center gap-2 mb-8">
                <!-- Les boutons seront injectés ici par JS -->
            </div>

            <!-- Conteneur pour le contenu des onglets -->
            <div id="tab-content" class="glass-card p-6 md:p-8 text-white">
                <!-- Le contenu de l'onglet actif sera affiché ici -->
            </div>
        </main>
    </div>

    <!-- Modal Tuteur IA -->
    <button id="openAiTutorBtn" class="fixed bottom-6 right-6 glass-button text-white font-semibold py-3 px-5 rounded-full shadow-lg hover:scale-105 transform transition-transform duration-300 z-50">
        Ouvrir le Tuteur IA
    </button>

    <div id="aiTutorModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 z-40 hidden opacity-0">
        <div class="glass-card w-full max-w-2xl h-[80vh] flex flex-col text-white">
            <div class="flex justify-between items-center p-4 border-b border-white/20">
                <h2 class="text-xl font-bold">Tuteur IA Contextuel</h2>
                <button id="closeAiTutorBtn" class="text-2xl">&times;</button>
            </div>
            <div id="chat-messages" class="flex-grow p-4 overflow-y-auto">
                <div class="chat-message p-3 rounded-lg mb-2 text-white/90">
                    Bonjour ! Posez-moi vos questions sur la séquence actuelle. Je suis pré-chargé avec le contexte du cours pour vous aider au mieux.
                </div>
            </div>
            <div class="p-4 border-t border-white/20">
                <div class="flex gap-2">
                    <input type="text" id="chat-input" class="w-full bg-white/10 border border-white/30 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-white/50 text-white placeholder-white/50" placeholder="Posez votre question ici...">
                    <button id="send-chat-btn" class="glass-button text-white font-semibold px-4 py-2 rounded-lg">Envoyer</button>
                </div>
                 <div id="chat-loader" class="mt-2 hidden">
                    <div class="flex items-center gap-2 text-sm text-white/70">
                         <div class="loader !w-5 !h-5 !border-2"></div>
                         <span>Le tuteur IA réfléchit...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
    // --- CONFIGURATION DE L'API GEMINI ---
    const GEMINI_API_KEY = "AIzaSyBsrLWx3sGsGEg27xvw1FW1kvVImt2A_Fo";
    const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + GEMINI_API_KEY;

    // --- DONNÉES DU PROGRAMME D'ÉTUDE ---
    const syllabusData = {
        "seq0": {
            title: "Conseils généraux",
            course: `
                <h2>Bienvenue dans ce programme d'étude interactif !</h2>
                <p>Cette séquence inaugurale vous donne des conseils pour aborder au mieux ce module. L'objectif du Processus 1 est de vous rendre compétent dans le contrôle et le traitement comptable des opérations commerciales courantes d'une entreprise.</p>
                <h3>Approche pédagogique</h3>
                <p>Chaque séquence est structurée de la manière suivante :</p>
                <ul>
                    <li><strong>Cours :</strong> Une présentation théorique des concepts clés.</li>
                    <li><strong>Étude de Cas :</strong> Une mise en situation concrète pour appliquer la théorie.</li>
                    <li><strong>Exercices :</strong> Des questions variées pour tester et renforcer votre compréhension. Utilisez le bouton de correction par IA pour obtenir un feedback détaillé !</li>
                </ul>
                <p>N'oubliez pas d'utiliser le <strong>Tuteur IA</strong> (en bas à droite) si vous avez des questions spécifiques sur une notion. Il est là pour vous aider !</p>
            `,
            caseStudy: `
                <h3>Cas d'utilisation des outils IA</h3>
                <p><strong>Scénario :</strong> Léa, une étudiante en BTS CG, prépare son examen. Elle a des difficultés avec la distinction entre TVA sur les débits et TVA sur les encaissements (Séquence 8).</p>
                <p><strong>Utilisation du Tuteur IA :</strong> Elle ouvre le tuteur IA et demande : "Peux-tu m'expliquer avec un exemple simple la différence entre la TVA sur les débits et sur les encaissements pour une prestation de service ?" L'IA lui fournit une réponse claire et contextualisée.</p>
                <p><strong>Utilisation de la Correction IA :</strong> Après avoir fait les exercices de la Séquence 8, elle soumet ses réponses. L'IA lui indique une erreur dans le calcul de la TVA déductible et lui explique pourquoi son raisonnement était incorrect, en lui citant la règle applicable.</p>
                <p><strong>Utilisation de l'Atelier HTML :</strong> Pour synthétiser ses connaissances, Léa se rend dans l'Atelier HTML et tape : "Crée-moi un tableau comparatif avec deux colonnes : 'TVA sur les débits' et 'TVA sur les encaissements'. Pour chaque colonne, ajoute des lignes pour 'Fait générateur', 'Exigibilité' et 'Exemple'." L'IA génère instantanément un tableau qu'elle peut utiliser pour ses révisions.</p>
            `,
            exercises: []
        },
        "seq1": {
            title: "Les acteurs de l’entreprise",
            course: `
                <h2>Activité 1.1 – Analyse du système d’information comptable (SIC)</h2>
                <h3>Séquence 1 - Les acteurs de l’entreprise</h3>
                <p>Une entreprise n'est pas une entité isolée. Elle interagit en permanence avec un ensemble de partenaires, internes et externes, qui ont des attentes et des rôles différents. Ces interactions créent des flux (matériels, financiers, informationnels) qui sont au cœur de l'activité comptable.</p>
                
                <h4>1. Les partenaires internes</h4>
                <ul>
                    <li><strong>Les salariés :</strong> Ils fournissent un travail en échange d'une rémunération. Leurs besoins d'information concernent leur paie, leurs droits sociaux, et la santé de l'entreprise qui garantit leur emploi.</li>
                    <li><strong>Les dirigeants :</strong> Ils pilotent l'entreprise, prennent les décisions stratégiques et ont besoin d'informations de synthèse (tableaux de bord, indicateurs de performance) pour orienter leurs actions.</li>
                    <li><strong>Les associés/actionnaires :</strong> Ils apportent le capital et attendent en retour une rémunération sous forme de dividendes et une augmentation de la valeur de leur investissement. Ils ont besoin d'informations financières (bilan, compte de résultat) pour évaluer la rentabilité et la solvabilité de l'entreprise.</li>
                </ul>

                <h4>2. Les partenaires externes</h4>
                <ul>
                    <li><strong>Les clients :</strong> Ils achètent les biens ou services produits. Leurs besoins d'information portent sur les produits, les prix, les conditions de vente. Ils sont la source principale des revenus.</li>
                    <li><strong>Les fournisseurs :</strong> Ils fournissent les matières premières, marchandises ou services nécessaires à l'activité. Ils ont besoin d'informations sur la solvabilité de l'entreprise pour accorder des délais de paiement.</li>
                    <li><strong>La banque :</strong> Elle finance l'entreprise (emprunts), gère ses flux de trésorerie et propose des services financiers. Elle a besoin d'informations détaillées sur la santé financière de l'entreprise pour évaluer le risque de crédit.</li>
                    <li><strong>L'État et les administrations :</strong> Ils prélèvent des impôts et taxes, et accordent parfois des subventions. Ils exigent des informations comptables et fiscales précises pour s'assurer du respect de la réglementation.</li>
                </ul>
            `,
            caseStudy: `
                <h3>Étude de Cas : Boulangerie "Le Pain Doré"</h3>
                <p>La SARL "Le Pain Doré" est une boulangerie artisanale qui emploie 3 salariés. Le gérant, M. Dubois, souhaite investir dans un nouveau four plus performant pour un coût de 15 000 €. Pour cela, il doit convaincre plusieurs acteurs.</p>
                <p><strong>Analyse :</strong></p>
                <p><strong>La banque :</strong> Pour obtenir un prêt, M. Dubois doit présenter un plan d'affaires solide, incluant les bilans et comptes de résultat des années précédentes, ainsi qu'un prévisionnel financier montrant comment le nouveau four augmentera la rentabilité.</p>
                <p><strong>Les salariés :</strong> Ils s'inquiètent de la charge de travail supplémentaire. M. Dubois doit leur présenter les avantages du four (moins de pénibilité, production plus rapide) et discuter d'une éventuelle prime si les objectifs de production sont atteints.</p>
                <p><strong>Le fournisseur de farine :</strong> Il s'interroge sur la capacité de la boulangerie à payer ses factures si elle s'endette. M. Dubois pourrait lui partager une version simplifiée de son prévisionnel pour le rassurer.</p>
                <p><strong>L'associé de M. Dubois :</strong> Il veut s'assurer que cet investissement ne mettra pas en péril la distribution de dividendes. Une simulation de l'impact de l'emprunt sur le résultat net est nécessaire.</p>
            `,
            exercises: [
                { id: 'q1-1', type: 'qcm', question: `Quel partenaire interne apporte le capital à l'entreprise ?`, options: [`Les salariés`, `Les dirigeants`, `Les associés/actionnaires`, `Les clients`], answer: `Les associés/actionnaires` },
                { id: 'q1-2', type: 'text', question: `Quel type de flux un salarié fournit-il à l'entreprise en échange de son salaire ?`, answer: `Un flux de travail (ou flux réel).` },
                { id: 'q1-3', type: 'textarea', question: `Expliquez pourquoi l'État est à la fois un partenaire qui prélève des ressources et qui peut en apporter à l'entreprise. Donnez un exemple pour chaque cas.`, answer: `L'État prélève des ressources via les impôts et taxes (ex: TVA, Impôt sur les Sociétés). Il peut apporter des ressources via des subventions (ex: aide à l'embauche, subvention pour l'innovation).` },
            ]
        },
        "seq2": {
            title: "Le système d’information comptable",
            course: `
                <h2>Activité 1.1 – Analyse du système d’information comptable (SIC)</h2>
                <h3>Séquence 2 - Le système d’information comptable</h3>
                <p>Le Système d'Information Comptable (SIC) est un sous-ensemble du système d'information global de l'entreprise. Son rôle est de collecter, traiter, stocker et diffuser les informations financières pertinentes pour les différents acteurs.</p>
                <h4>1. Rôle du SIC</h4>
                <p>Le SIC n'est pas qu'un outil d'enregistrement. Il est au cœur de la gestion des activités de l'entreprise. Il permet de :</p>
                <ul>
                    <li><strong>Mémoriser les opérations :</strong> Garder une trace de tous les flux (achats, ventes, paiements).</li>
                    <li><strong>Produire les états financiers :</strong> Établir le bilan, le compte de résultat et l'annexe, qui sont obligatoires et informent les partenaires externes.</li>
                    <li><strong>Aider à la décision :</strong> Fournir des informations pour le pilotage interne (comptabilité de gestion, calcul des coûts, budgets).</li>
                    <li><strong>Servir de preuve :</strong> Les documents comptables ont une valeur juridique en cas de litige.</li>
                </ul>
                <h4>2. Ressources du SIC</h4>
                <p>Le SIC s'appuie sur plusieurs types de ressources :</p>
                <ul>
                    <li><strong>Ressources humaines :</strong> Le comptable, l'expert-comptable, les gestionnaires qui utilisent le système.</li>
                    <li><strong>Ressources matérielles et logicielles :</strong> Les ordinateurs, les serveurs, et surtout le Progiciel de Gestion Intégré (PGI ou ERP en anglais) qui centralise toutes les données.</li>
                    <li><strong>Ressources procédurales :</strong> Les règles et méthodes comptables (comme le Plan Comptable Général - PCG) qui garantissent l'uniformité et la fiabilité des informations.</li>
                </ul>
            `,
            caseStudy: `
                <h3>Étude de Cas : Modernisation du SIC chez "Innov-Textile"</h3>
                <p>L'entreprise "Innov-Textile" utilisait plusieurs logiciels différents pour sa comptabilité, sa gestion des stocks et sa facturation. Cela entraînait des erreurs de double saisie et des retards dans la production des rapports financiers.</p>
                <p><strong>Décision :</strong> La direction décide d'investir dans un Progiciel de Gestion Intégré (PGI).</p>
                <p><strong>Mise en œuvre :</strong></p>
                <ol>
                    <li><strong>Choix du logiciel (Ressource logicielle) :</strong> Après une étude de marché, ils choisissent un PGI adapté aux PME du secteur textile.</li>
                    <li><strong>Formation du personnel (Ressource humaine) :</strong> Les comptables et les commerciaux sont formés pour utiliser le nouvel outil. De nouvelles procédures de saisie sont établies (Ressource procédurale).</li>
                    <li><strong>Migration des données :</strong> Les anciennes données sont transférées dans le PGI.</li>
                </ol>
                <p><strong>Résultats :</strong> Après 6 mois, la direction constate que les factures sont émises plus rapidement, l'état des stocks est fiable en temps réel et la clôture comptable mensuelle est passée de 5 jours à 2 jours. Les décisions d'achat de matières premières sont plus précises, basées sur des données fiables.</p>
            `,
            exercises: [
                { id: 'q2-1', type: 'qcm', question: `Laquelle de ces affirmations sur le SIC est fausse ?`, options: [`Il sert uniquement à enregistrer les opérations passées.`, `Il aide les dirigeants à prendre des décisions.`, `Il produit des documents obligatoires comme le bilan.`, `Ses informations peuvent servir de preuve en cas de litige.`], answer: `Il sert uniquement à enregistrer les opérations passées.` },
                { id: 'q2-2', type: 'cloze', question: `Le Plan Comptable Général (PCG) est une ressource de type _______.`, answer: `procédurale` },
                { id: 'q2-3', type: 'textarea', question: `Quels sont les avantages d'un PGI (Progiciel de Gestion Intégré) par rapport à l'utilisation de plusieurs logiciels séparés ?`, answer: `Un PGI centralise les données, évite la double saisie, réduit les erreurs, fournit une information en temps réel et améliore la coordination entre les services (comptabilité, ventes, stocks).` },
            ]
        },
        "seq3": {
            title: "L’information comptable de synthèse",
            course: `
                <h2>Activité 1.1 – Analyse du système d’information comptable (SIC)</h2>
                <h3>Séquence 3 - L'information comptable de synthèse</h3>
                <p>À la fin de chaque exercice comptable, le SIC produit des documents de synthèse qui présentent une image fidèle du patrimoine, de la situation financière et du résultat de l'entreprise. Les deux principaux sont le Bilan et le Compte de Résultat.</p>
                
                <h4>1. Le Bilan</h4>
                <p>Le bilan est une <strong>photographie</strong> du patrimoine de l'entreprise à un instant T (généralement le dernier jour de l'exercice). Il se présente en deux parties qui doivent toujours être égales : l'Actif et le Passif.</p>
                <ul>
                    <li><strong>L'Actif (Emplois) :</strong> Ce que l'entreprise <strong>possède</strong>. Les éléments sont classés par ordre de liquidité croissante (du moins liquide au plus liquide).
                        <ul>
                            <li><u>Actif immobilisé :</u> Biens destinés à rester durablement dans l'entreprise (terrains, bâtiments, machines, brevets).</li>
                            <li><u>Actif circulant :</u> Éléments liés au cycle d'exploitation (stocks, créances clients, trésorerie disponible en banque ou en caisse).</li>
                        </ul>
                    </li>
                    <li><strong>Le Passif (Ressources) :</strong> D'où vient l'argent qui a financé l'Actif.
                        <ul>
                            <li><u>Capitaux propres :</u> Ressources stables appartenant à l'entreprise (capital apporté par les associés, réserves, résultat de l'exercice).</li>
                            <li><u>Dettes :</u> Ressources externes que l'entreprise devra rembourser (emprunts bancaires, dettes fournisseurs, dettes fiscales et sociales).</li>
                        </ul>
                    </li>
                </ul>
                <p>L'équation fondamentale du bilan est : <strong>Actif = Passif (Capitaux Propres + Dettes)</strong>.</p>

                <h4>2. Le Compte de Résultat</h4>
                <p>Le compte de résultat est un <strong>film</strong> de l'activité de l'entreprise sur une période donnée (l'exercice comptable). Il explique comment le résultat (bénéfice ou perte) a été formé.</p>
                <ul>
                    <li><strong>Les Produits :</strong> Tout ce qui a <strong>enrichi</strong> l'entreprise durant l'exercice. Principalement le chiffre d'affaires (ventes de marchandises, de produits finis, prestations de services), mais aussi les produits financiers (intérêts perçus) ou exceptionnels.</li>
                    <li><strong>Les Charges :</strong> Tout ce qui a <strong>appauvri</strong> l'entreprise. Elles comprennent les achats de marchandises et matières premières, les frais généraux (loyers, salaires, énergie), les impôts, les charges financières (intérêts payés sur les emprunts) et les charges exceptionnelles.</li>
                </ul>
                <p>La formule du résultat est : <strong>Résultat = Total des Produits - Total des Charges</strong>. Si le résultat est positif, c'est un <strong>bénéfice</strong>. S'il est négatif, c'est une <strong>perte</strong>.</p>
            `,
            caseStudy: `
                <h3>Étude de Cas : Analyse simplifiée de "TechPlus" au 31/12/N</h3>
                <p>L'entreprise "TechPlus" a été créée le 01/01/N avec un capital de 50 000 €. Au 31/12/N, son comptable a sorti les informations suivantes :</p>
                <ul>
                    <li>Ventes de l'année : 120 000 €</li>
                    <li>Achats de marchandises : 60 000 €</li>
                    <li>Salaires et charges sociales : 30 000 €</li>
                    <li>Emprunt bancaire : 20 000 €</li>
                    <li>Matériel informatique : 15 000 €</li>
                    <li>Dettes fournisseurs : 10 000 €</li>
                    <li>Créances clients : 12 000 €</li>
                    <li>Disponibilités en banque : 37 000 €</li>
                </ul>
                <p><strong>Analyse :</strong></p>
                <p><strong>Compte de Résultat :</strong><br>
                Produits = 120 000 € (Ventes)<br>
                Charges = 60 000 € (Achats) + 30 000 € (Salaires) = 90 000 €<br>
                <strong>Résultat (Bénéfice) = 120 000 - 90 000 = 30 000 €</strong></p>
                <p><strong>Bilan :</strong><br>
                <u>Actif :</u><br>
                - Actif immobilisé : 15 000 € (Matériel)<br>
                - Actif circulant : 12 000 € (Créances) + 37 000 € (Banque) = 49 000 €<br>
                <strong>Total Actif = 15 000 + 49 000 = 64 000 €</strong><br>
                <u>Passif :</u><br>
                - Capitaux propres : 50 000 € (Capital) + 30 000 € (Résultat) = 80 000 €<br> 
                - Dettes : 20 000 € (Emprunt) + 10 000 € (Dettes fournisseurs) = 30 000 €<br>
                <strong>Total Passif = 80 000 + 30 000 = 110 000 €</strong><br>
                <em>Oups ! Le bilan n'est pas équilibré. C'est normal, c'est une version très simplifiée. En réalité, le bénéfice est calculé après impôts, des amortissements sont constatés, et d'autres postes existent. L'important est de comprendre la logique.</em><br>
                Note pour une analyse correcte : l'équation est Actif = Capitaux Propres + Dettes. Ici, on aurait 64 000 = Capitaux Propres + 30 000. Donc, les Capitaux Propres devraient être 34 000 €. La différence avec les 80 000 € vient des flux de trésorerie (comme l'apport initial) qui ne sont pas détaillés ici.
            `,
            exercises: [
                { id: 'q3-1', type: 'qcm', question: `Lequel de ces éléments figure à l'Actif du bilan ?`, options: [`Emprunt bancaire`, `Capital social`, `Créances clients`, `Dettes fournisseurs`], answer: `Créances clients` },
                { id: 'q3-2', type: 'cloze', question: `Si le total des produits est de 200 000 € et le total des charges est de 180 000 €, l'entreprise réalise un ______ de 20 000 €.`, answer: `bénéfice` },
                { id: 'q3-3', type: 'textarea', question: `Quelle est la différence fondamentale entre un Bilan et un Compte de Résultat en termes de temporalité ?`, answer: `Le bilan est une photographie du patrimoine à un instant T, tandis que le compte de résultat est un film qui retrace l'activité sur une période donnée (un exercice).` },
            ]
        },
        "seq6": {
            title: "Les opérations d’achat et de vente",
            course: `
                <h2>Activité 1.3 – Enregistrement et suivi des opérations comptables relatives aux clients</h2>
                <h3>Séquence 6 - Les opérations d’achat et de vente</h3>
                <p>Le cœur de l'activité commerciale d'une entreprise réside dans ses opérations d'achat et de vente. Ces opérations sont matérialisées par des documents commerciaux, principalement les factures, qui ont une importance capitale tant sur le plan commercial que comptable et fiscal.</p>
                <h4>1. Le processus d'achat/vente</h4>
                <p>Le cycle commercial typique suit plusieurs étapes :</p>
                <ol>
                    <li><strong>Devis :</strong> Proposition de prix par le vendeur. N'engage pas le client.</li>
                    <li><strong>Bon de commande :</strong> Document émis par le client pour accepter l'offre. Il formalise l'accord.</li>
                    <li><strong>Bon de livraison :</strong> Accompagne la marchandise et prouve sa réception par le client.</li>
                    <li><strong>Facture :</strong> Document émis par le vendeur qui détaille la vente et crée la créance (pour le vendeur) et la dette (pour l'acheteur). C'est la pièce comptable fondamentale.</li>
                </ol>
                <h4>2. La Facture de Doit</h4>
                <p>La facture de doit est le document standard de vente. Elle doit comporter des <strong>mentions obligatoires</strong> pour être valide : identité du vendeur et de l'acheteur, numéro de facture, date, description des produits/services, prix HT, taux et montant de la TVA, montant TTC.</p>
                <p>La facture peut aussi inclure des <strong>réductions commerciales</strong> :</p>
                <ul>
                    <li><strong>Rabais :</strong> Pour un défaut de qualité ou un retard de livraison.</li>
                    <li><strong>Remise :</strong> Accordée en fonction du volume d'achat ou de la relation commerciale.</li>
                    <li><strong>Ristourne :</strong> Réduction calculée sur le total des achats d'une période, accordée en fin de période.</li>
                </ul>
                <p>Il existe aussi une <strong>réduction financière</strong> :</p>
                <ul>
                    <li><strong>Escompte :</strong> Accordé pour un paiement anticipé (avant l'échéance).</li>
                </ul>
                <h4>3. La Facture d'Avoir</h4>
                <p>La facture d'avoir est une note de crédit qui annule ou corrige une facture de doit précédente. Elle est émise dans plusieurs cas :</p>
                <ul>
                    <li><strong>Retour de marchandises</strong> par le client.</li>
                    <li><strong>Erreur</strong> sur la facture initiale (prix, quantité).</li>
                    <li><strong>Octroi d'une réduction commerciale</strong> (rabais, ristourne) après la facturation initiale.</li>
                </ul>
            `,
            caseStudy: `
                <h3>Étude de Cas : Commande chez "FourniTout"</h3>
                <p>L'entreprise "Alpha" commande 100 chaises au fournisseur "FourniTout" à 50 € HT l'unité. Un escompte de 2% est possible pour paiement comptant.</p>
                <p><strong>1. Facture de Doit initiale :</strong><br>
                - Montant Brut HT : 100 chaises * 50 € = 5 000 €<br>
                - TVA à 20% : 5 000 € * 0,20 = 1 000 €<br>
                - Total TTC : 6 000 €</p>
                <p><strong>2. Scénario avec retour et rabais :</strong><br>
                À la livraison, "Alpha" constate que 5 chaises sont abîmées. Elles sont retournées. De plus, "FourniTout" accorde un rabais de 10% sur les chaises restantes en dédommagement du retard de livraison.</p>
                <p><strong>3. Émission de la Facture d'Avoir :</strong><br>
                "FourniTout" émet un avoir pour corriger la situation :<br>
                - Avoir pour retour de 5 chaises : 5 * 50 € = -250 € HT<br>
                - Rabais de 10% sur les 95 chaises restantes : (95 * 50 €) * 10% = -475 € HT<br>
                - Montant total de l'avoir HT : -250 - 475 = -725 € HT<br>
                - TVA sur l'avoir : -725 € * 20% = -145 €<br>
                - Total TTC de l'avoir : -870 €</p>
                <p><strong>Finalement, "Alpha" ne devra payer que :</strong> 6 000 € - 870 € = 5 130 €.</p>
            `,
            exercises: [
                { id: 'q6-1', type: 'qcm', question: `Quelle réduction est accordée pour un paiement anticipé ?`, options: [`Rabais`, `Remise`, `Ristourne`, `Escompte`], answer: `Escompte` },
                { id: 'q6-2', type: 'cloze', question: `Une facture qui annule ou rectifie une facture précédente est une facture d'_____.`, answer: `avoir` },
                { id: 'q6-3', type: 'textarea', question: `Un client vous retourne une marchandise d'une valeur de 200 € HT (TVA 20%). Calculez le montant TTC de l'avoir que vous devez lui émettre.`, answer: `Le montant HT de l'avoir est de 200 €. La TVA sur l'avoir est de 200 * 20% = 40 €. Le montant TTC de l'avoir est donc de 200 + 40 = 240 €.` },
            ]
        },
        "seq4": {
            title: "Traitement de l’information",
            course: `
                <h2>Activité 1.2 – Contrôle des documents commerciaux</h2>
                <h3>Séquence 4 - Le traitement de l’information comptable</h3>
                <p>Le traitement de l'information comptable est un processus structuré qui transforme les événements économiques bruts (transactions) en informations financières synthétiques et fiables. Ce processus suit des étapes logiques et rigoureuses.</p>
                <h4>Les 5 étapes du traitement de l'information</h4>
                <ol>
                    <li><strong>Collecte des pièces justificatives :</strong> Chaque opération doit être prouvée par un document (facture, quittance, bon de commande, relevé bancaire). C'est la base de la comptabilité probante.</li>
                    <li><strong>Comptabilisation au Journal :</strong> Les opérations sont enregistrées de manière chronologique dans des journaux spécialisés (achats, ventes, banque...). Chaque écriture respecte le principe de la partie double (débit = crédit).</li>
                    <li><strong>Report au Grand-Livre :</strong> Les écritures du journal sont ensuite reportées dans les comptes correspondants du Grand-Livre. Ce dernier regroupe toutes les opérations par compte (ex: compte client Dupont, compte Banque Populaire).</li>
                    <li><strong>Établissement de la Balance :</strong> Périodiquement, on établit une balance qui récapitule tous les comptes du Grand-Livre avec leurs totaux (débits et crédits) et leurs soldes. Elle permet de vérifier l'égalité arithmétique : Total des débits = Total des crédits.</li>
                    <li><strong>Établissement des documents de synthèse :</strong> En fin d'exercice, à partir de la balance, on élabore le Bilan, le Compte de Résultat et l'Annexe.</li>
                </ol>
            `,
            caseStudy: `
                <h3>Étude de Cas : Le premier mois de "Jeune Pousse SAS"</h3>
                <p>Le 10 janvier, "Jeune Pousse SAS" achète un ordinateur pour 1 200 € TTC (TVA 20%) à son fournisseur "INFO-MAX". Elle paie par chèque le 25 janvier.</p>
                <p><strong>Traitement de l'information :</strong></p>
                <ol>
                    <li><strong>Pièce justificative :</strong> La facture d'achat n°F0123 de "INFO-MAX".</li>
                    <li><strong>Journal (d'achats) au 10/01 :</strong>
                        <ul>
                           <li>Débit Compte 6063 (Fournitures de bureau) : 1 000 €</li>
                           <li>Débit Compte 44566 (TVA déductible) : 200 €</li>
                           <li>Crédit Compte 401INFO (Fournisseur INFO-MAX) : 1 200 €</li>
                        </ul>
                    </li>
                     <li><strong>Journal (de banque) au 25/01 :</strong>
                        <ul>
                           <li>Débit Compte 401INFO (Fournisseur INFO-MAX) : 1 200 €</li>
                           <li>Crédit Compte 512 (Banque) : 1 200 €</li>
                        </ul>
                    </li>
                    <li><strong>Grand-Livre :</strong> Le compte 401INFO montrera un débit de 1200 et un crédit de 1200. Son solde sera de 0. Le compte 512 montrera un crédit de 1200.</li>
                    <li><strong>Balance :</strong> Les soldes de tous les comptes seront listés.</li>
                </ol>
            `,
            exercises: [
                { id: 'q4-1', type: 'qcm', question: 'Quel document regroupe les opérations par compte ?', options: ['Le Journal', 'La Balance', 'Le Grand-Livre', 'Le Bilan'], answer: 'Le Grand-Livre' },
                { id: 'q4-2', type: 'cloze', question: 'La vérification de l\'égalité "Total Débits = Total Crédits" se fait grâce à la _____.', answer: 'Balance' },
                { id: 'q4-3', type: 'textarea', question: 'Une entreprise reçoit une facture de vente le 15 mars. À quelle étape du traitement comptable cette facture est-elle utilisée en premier lieu et dans quel journal est-elle enregistrée ?', answer: 'Elle est utilisée à l\'étape 1 (collecte des pièces justificatives) et enregistrée au journal des ventes à l\'étape 2.' },
            ]
        },
        "seq5": {
            title: "Normalisation comptable",
            course: `
                <h2>Activité 1.2 – Contrôle des documents commerciaux</h2>
                <h3>Séquence 5 - La normalisation comptable</h3>
                <p>La comptabilité n'est pas une pratique libre. Elle est encadrée par un ensemble de règles et de principes qui visent à garantir que l'information financière soit fiable, pertinente et comparable entre les entreprises. C'est ce qu'on appelle la normalisation comptable.</p>
                <h4>1. Les sources du droit comptable</h4>
                <p>Les règles comptables proviennent de plusieurs sources hiérarchisées :</p>
                <ul>
                    <li><strong>Sources internationales :</strong> Les normes IFRS (International Financial Reporting Standards), obligatoires pour les comptes consolidés des sociétés cotées en Europe.</li>
                    <li><strong>Sources européennes :</strong> Les directives comptables de l'Union Européenne, qui harmonisent les législations des États membres.</li>
                    <li><strong>Sources nationales (France) :</strong>
                        <ul>
                            <li>Le <strong>Code de Commerce</strong> : Il pose les grandes obligations (tenir une comptabilité, établir des comptes annuels...).</li>
                            <li>Le <strong>Plan Comptable Général (PCG)</strong> : C'est le référentiel technique principal, qui définit la liste des comptes, les modèles de bilan et de compte de résultat, et les méthodes d'évaluation. Il est élaboré par l'Autorité des Normes Comptables (ANC).</li>
                        </ul>
                    </li>
                </ul>
                <h4>2. Les principes comptables fondamentaux</h4>
                <p>Pour donner une "image fidèle" de l'entreprise, la comptabilité doit respecter plusieurs grands principes :</p>
                <ul>
                    <li><strong>Continuité de l'exploitation :</strong> On suppose que l'entreprise va poursuivre son activité. Les biens sont donc évalués à leur valeur d'utilité, non à leur valeur de liquidation.</li>
                    <li><strong>Indépendance des exercices :</strong> Les charges et les produits doivent être rattachés à l'exercice qui les concerne, même s'ils sont payés ou encaissés sur un autre exercice.</li>
                    <li><strong>Coûts historiques :</strong> Un bien est enregistré à son coût d'acquisition. Cette valeur reste la base, même si la valeur de marché du bien évolue (sauf exceptions).</li>
                    <li><strong>Prudence :</strong> Les plus-values potentielles ne sont pas comptabilisées, mais les moins-values probables doivent l'être (via des provisions ou dépréciations). On anticipe les pertes, mais pas les gains.</li>
                    <li><strong>Permanence des méthodes :</strong> L'entreprise doit utiliser les mêmes méthodes comptables d'un exercice à l'autre pour assurer la comparabilité des comptes.</li>
                </ul>
            `,
            caseStudy: `
                <h3>Étude de Cas : Le stock de "Mode-Éphémère"</h3>
                <p>L'entreprise "Mode-Éphémère" a en stock au 31/12/N une collection de vêtements achetée 10 000 €. En raison d'un changement de tendance, le comptable estime que cette collection ne pourra se vendre que pour 7 000 €.</p>
                <p><strong>Analyse et décision :</strong></p>
                <p>Le comptable est confronté à plusieurs principes :</p>
                <ul>
                    <li><strong>Principe des coûts historiques :</strong> Le stock a été enregistré à 10 000 €.</li>
                    <li><strong>Principe de prudence :</strong> Il existe une perte probable de 3 000 € (10 000 - 7 000).</li>
                </ul>
                <p><strong>Application :</strong> Le principe de prudence l'emporte. Le comptable doit constater une <strong>dépréciation</strong> du stock de 3 000 €. Le stock apparaîtra donc au bilan pour sa valeur nette de 7 000 €, et une charge de 3 000 € sera enregistrée au compte de résultat, diminuant le bénéfice de l'exercice N. Il ne faut surtout pas attendre l'année N+1 pour constater la perte au moment de la vente.</p>
            `,
            exercises: [
                { id: 'q5-1', type: 'qcm', question: `Quel principe comptable impose de rattacher les charges et produits à leur exercice de survenance ?`, options: ['Prudence', 'Coûts historiques', `Indépendance des exercices`, `Continuité de l'exploitation`], answer: `Indépendance des exercices` },
                { id: 'q5-2', type: 'cloze', question: `En France, le principal référentiel technique de la comptabilité est le _____.`, answer: 'Plan Comptable Général' },
                { id: 'q5-3', type: 'textarea', question: `Une entreprise découvre en janvier N+1 qu'un de ses clients, qui lui devait 5 000 € au 31/12/N, a fait faillite. Au nom de quels principes doit-elle ajuster ses comptes de l'exercice N et que doit-elle faire ?`, answer: `Au nom des principes d'indépendance des exercices et de prudence, l'entreprise doit constater la perte sur l'exercice N. Elle doit passer une écriture de provision pour créance douteuse (ou de perte) de 5 000 € au 31/12/N, même si l'information est connue après.` },
            ]
        },
        "seq7": {
            title: "Suivi clients et fournisseurs",
            course: `
                <h2>Activité 1.3 – Enregistrement et suivi des opérations comptables relatives aux clients</h2>
                <h3>Séquence 7 - Le suivi des clients et des fournisseurs</h3>
                <p>Le suivi rigoureux des comptes de tiers (clients et fournisseurs) est essentiel pour la gestion de la trésorerie et la maîtrise du risque financier. Il s'agit de s'assurer que les factures sont payées et reçues dans les temps.</p>
                <h4>1. Le suivi commercial</h4>
                <p>Le suivi commercial concerne la gestion des avoirs pour les retours de marchandises ou les réductions accordées après facturation. Chaque avoir doit faire l'objet d'une écriture comptable qui vient diminuer la créance client ou la dette fournisseur initiale.</p>
                <h4>2. Le suivi financier : Lettrage et Pointage</h4>
                <p>Le suivi financier repose sur une technique essentielle : le <strong>lettrage</strong> des comptes.</p>
                <ul>
                    <li><strong>Principe :</strong> Le lettrage consiste à associer (pointer) une ou plusieurs factures avec leur(s) règlement(s) correspondant(s). Une facture et son règlement sont "lettrés" lorsque le rapprochement est fait.</li>
                    <li><strong>Objectif :</strong> Les écritures non lettrées dans un compte de tiers représentent les factures en attente de règlement. Cela permet de savoir immédiatement qui doit de l'argent et à qui on en doit.</li>
                    <li><strong>Méthode :</strong> Dans le Grand-Livre d'un client ou d'un fournisseur, on sélectionne la ligne de la facture (ex: 1200 € au débit du compte client) et la ligne du règlement (ex: 1200 € au crédit du compte client) et on leur affecte un même code (une lettre : A, B, C...).</li>
                </ul>
                <h4>3. La gestion du risque client</h4>
                <p>Le principal outil de suivi du risque client est la <strong>Balance âgée</strong>. C'est un état qui classe les créances clients non réglées par ancienneté (par exemple : non échues, échues depuis 1-30 jours, 31-60 jours, + de 60 jours). Elle permet de :</p>
                <ul>
                    <li>Visualiser rapidement les retards de paiement.</li>
                    <li>Identifier les clients "à risque" qui paient systématiquement en retard.</li>
                    <li>Prioriser les actions de relance.</li>
                </ul>
                <p>En fonction de l'analyse de la balance âgée, l'entreprise peut lancer des procédures de <strong>relance</strong> (amiable puis contentieuse) et doit, en fin d'exercice, comptabiliser des <strong>provisions pour créances douteuses</strong> pour les factures qui risquent de ne jamais être payées.</p>
            `,
            caseStudy: `
                <h3>Étude de Cas : La balance âgée de "DISTRIB S.A."</h3>
                <p>Au 31 mars, le comptable de "DISTRIB S.A." édite la balance âgée de ses clients. Il constate que le client "DURAND" a une facture de 2 500 € impayée depuis 75 jours, malgré deux lettres de relance.</p>
                <p><strong>Analyse et Actions :</strong></p>
                <p><strong>Constat :</strong> Le client DURAND présente un risque élevé de non-recouvrement. La créance est dans la tranche "+ de 60 jours".</p>
                <p><strong>Actions immédiates :</strong></p>
                <ol>
                    <li>Le service de recouvrement contacte le client par téléphone pour une dernière tentative de règlement amiable.</li>
                    <li>Les livraisons futures pour ce client sont bloquées jusqu'à régularisation.</li>
                </ol>
                <p><strong>Actions comptables (si le risque se confirme) :</strong></p>
                <ol>
                    <li>Le compte client est reclassé de "Client" (411) à "Client douteux" (416).</li>
                    <li>Une provision pour dépréciation de la créance est calculée et comptabilisée, en estimant le pourcentage de perte probable (par exemple, 50% de la créance si une procédure est lancée, soit une provision de 1 250 €).</li>
                </ol>
            `,
            exercises: [
                { id: 'q7-1', type: 'qcm', question: `Quel est l'objectif principal du lettrage d'un compte client ?`, options: ['Calculer la TVA', 'Identifier les factures non payées', 'Préparer le bilan', 'Enregistrer les ventes'], answer: 'Identifier les factures non payées' },
                { id: 'q7-2', type: 'cloze', question: `L'état qui classe les créances par ancienneté s'appelle la _____.`, answer: 'Balance âgée' },
                { id: 'q7-3', type: 'textarea', question: `Un compte fournisseur présente au débit un règlement de 500 € et au crédit une facture de 500 €. Que pouvez-vous faire et que signifie le fait que ces deux lignes ne soient pas lettrées ?`, answer: `Je peux lettrer ces deux lignes. Le fait qu'elles ne soient pas lettrées signifie que le rapprochement entre la facture et son règlement n'a pas encore été effectué. Comptablement, la dette est soldée, mais le suivi n'est pas à jour.` },
            ]
        },
        "seq8": {
            title: "TVA sur opérations particulières",
            course: `
                <h2>Activité 1.4 – Production de l’information relative au risque client</h2>
                <h3>Séquence 8 - La TVA sur les opérations commerciales particulières</h3>
                <p>Le régime de la TVA se complexifie lorsqu'on aborde les opérations internationales ou certains secteurs spécifiques comme l'immobilier. Les règles visent à assurer que la taxe est perçue dans le pays de consommation, tout en maintenant la neutralité pour les entreprises.</p>
                <h4>1. Opérations avec l'étranger (Hors UE)</h4>
                <ul>
                    <li><strong>Exportations :</strong> Les ventes de biens expédiés hors de l'Union Européenne sont <strong>exonérées</strong> de TVA. Le vendeur facture Hors Taxes. Il doit conserver la preuve de l'exportation (document douanier) pour justifier l'exonération.</li>
                    <li><strong>Importations :</strong> Les achats de biens provenant de pays hors UE sont <strong>soumis à la TVA</strong> française lors de leur entrée sur le territoire. Depuis 2022, la TVA à l'importation est obligatoirement <strong>autoliquidée</strong> par l'entreprise importatrice sur sa déclaration de TVA. Cela signifie qu'elle la déclare et la déduit en même temps, sans avance de trésorerie à la douane.</li>
                </ul>
                <h4>2. Opérations Intracommunautaires (au sein de l'UE)</h4>
                <p>Entre professionnels assujettis à la TVA dans deux pays de l'UE :</p>
                <ul>
                    <li><strong>Livraisons intracommunautaires :</strong> Les ventes de biens à un client professionnel dans un autre pays de l'UE sont <strong>exonérées</strong> de TVA dans le pays de départ. Le vendeur doit obtenir et vérifier le numéro de TVA intracommunautaire de son client.</li>
                    <li><strong>Acquisitions intracommunautaires :</strong> L'acheteur qui reçoit le bien doit <strong>autoliquider</strong> la TVA dans son propre pays. Il collecte et déduit la TVA sur sa propre déclaration. L'opération est neutre pour sa trésorerie.</li>
                </ul>
                 <h4>3. Cas des travaux immobiliers (sous-traitance)</h4>
                <p>Dans le secteur du BTP, pour les travaux réalisés par un sous-traitant pour un donneur d'ordre (l'entreprise principale), un mécanisme d'<strong>autoliquidation de la TVA</strong> s'applique. Le sous-traitant facture ses prestations Hors Taxes au donneur d'ordre. C'est le donneur d'ordre qui se charge de déclarer et de déduire la TVA correspondante. Ce dispositif vise à lutter contre la fraude à la TVA dans ce secteur.</p>
            `,
            caseStudy: `
                <h3>Étude de Cas : "BATI-SÛR", entreprise du BTP</h3>
                <p>"BATI-SÛR" (entreprise française) réalise un chantier de rénovation. Pour cela, elle fait appel au sous-traitant "PLOMBERIE-EXPRESS" (français aussi) pour une prestation de 10 000 € HT. Par ailleurs, "BATI-SÛR" achète des outils spécifiques à une entreprise allemande "Werkzeug GmbH" pour 5 000 €.</p>
                <p><strong>Analyse et Traitement de la TVA :</strong></p>
                <p><strong>1. Facture du sous-traitant :</strong><br>
                "PLOMBERIE-EXPRESS" envoie une facture de 10 000 € à "BATI-SÛR" avec la mention "Autoliquidation". Il ne collecte pas de TVA.<br>
                Sur sa déclaration de TVA, "BATI-SÛR" va déclarer la TVA correspondante (20% * 10 000 = 2 000 €) à la fois en TVA collectée et en TVA déductible. L'impact sur sa trésorerie est nul.</p>
                <p><strong>2. Achat en Allemagne :</strong><br>
                "Werkzeug GmbH" envoie une facture de 5 000 € HT à "BATI-SÛR", après avoir vérifié son numéro de TVA intracommunautaire. C'est une livraison intracommunautaire exonérée pour l'allemand.<br>
                Pour "BATI-SÛR", c'est une acquisition intracommunautaire. Sur sa déclaration de TVA, elle va autoliquider la taxe : elle déclare 1 000 € (5 000 * 20%) en TVA collectée et déduit ces mêmes 1 000 € en TVA déductible.</p>
            `,
            exercises: [
                { id: 'q8-1', type: 'qcm', question: `Une entreprise française vend des marchandises à une entreprise en Suisse. La vente est :`, options: ['Soumise à la TVA française', 'Exonérée de TVA', 'Autoliquidée par le client suisse', 'Soumise à la TVA suisse'], answer: 'Exonérée de TVA' },
                { id: 'q8-2', type: 'cloze', question: `Lors d'une acquisition intracommunautaire, la TVA est _____ par l'acheteur.`, answer: 'autoliquidée' },
                { id: 'q8-3', type: 'textarea', question: `Quel est le principal avantage pour une entreprise du mécanisme d'autoliquidation de la TVA à l'importation ?`, answer: `Le principal avantage est pour la trésorerie. L'entreprise n'a pas besoin d'avancer le montant de la TVA à la douane au moment de l'importation, puisqu'elle la déclare et la déduit sur la même déclaration.` },
            ]
        },
        "seq9": {
            title: "Frais accessoires",
            course: `
                <h2>Activité 1.4 – Production de l’information relative au risque client</h2>
                <h3>Séquence 9 - Les frais accessoires aux achats et aux ventes</h3>
                <p>Lors d'une opération commerciale, des frais supplémentaires viennent souvent s'ajouter au prix principal des marchandises. Ces frais, dits "accessoires", doivent être correctement traités en comptabilité.</p>
                <h4>1. Le transport</h4>
                <p>Les frais de transport sur achats ou sur ventes (souvent appelés "port") peuvent être à la charge du vendeur ou de l'acheteur selon les conditions de vente (Incoterms).</p>
                <ul>
                    <li><strong>Port forfaitaire :</strong> Le vendeur facture un montant fixe pour le transport, quel que soit le coût réel. Ce montant est soumis à la TVA au même taux que la marchandise principale.</li>
                    <li><strong>Débours :</strong> Le vendeur paie le transporteur pour le compte de son client. Il refacture ensuite le coût exact au client. Dans ce cas, le transport n'est pas soumis à TVA pour le vendeur car il s'agit d'un simple remboursement de frais (les "débours"). Le transporteur, lui, facture la TVA au client final.</li>
                </ul>
                <p>Comptablement, les frais de port sur achats sont enregistrés au débit du compte <strong>6241 "Transports sur achats"</strong>. Les frais de port sur ventes sont enregistrés au crédit du compte <strong>7085 "Ports et frais accessoires facturés"</strong>.</p>
                <h4>2. Les emballages</h4>
                <p>On distingue plusieurs types d'emballages :</p>
                <ul>
                    <li><strong>Emballages perdus :</strong> Emballages non récupérables vendus avec le produit (cartons, bouteilles en plastique...). Leur coût est inclus dans le prix de vente.</li>
                    <li><strong>Emballages récupérables :</strong> Emballages que le vendeur prête au client et qu'il doit récupérer (palettes, bouteilles en verre consignées...). Pour inciter le client à les retourner, le vendeur facture une <strong>consigne</strong>.</li>
                </ul>
                <h4>3. La consignation d'emballages</h4>
                <p>La consignation n'est pas une vente. C'est une sorte de dépôt de garantie.</p>
                <ul>
                    <li><strong>Chez le fournisseur (vendeur) :</strong> La créance pour la consigne est enregistrée au débit du compte <strong>4196 "Clients - Dettes pour emballages consignés"</strong>. La consigne n'est pas soumise à TVA.</li>
                    <li><strong>Chez le client (acheteur) :</strong> La dette pour la consigne est enregistrée au crédit du compte <strong>4096 "Fournisseurs - Créances pour emballages à rendre"</strong>.</li>
                    <li><strong>Retour des emballages :</strong> Les écritures sont simplement contrepassées (annulées).</li>
                    <li><strong>Non-retour :</strong> Si le client ne rend pas les emballages, la consigne devient une vente. Le fournisseur doit alors émettre une facture pour la vente des emballages, soumise à TVA, et le client enregistre un achat (charge exceptionnelle).</li>
                </ul>
            `,
            caseStudy: `
                <h3>Étude de Cas : Livraison de "Bois & Co"</h3>
                <p>"Bois & Co" vend à son client "Artisan du Meuble" des planches de chêne pour 2 000 € HT. La livraison est effectuée sur 2 palettes consignées à 20 € l'unité. Le transport est facturé forfaitairement 100 € HT.</p>
                <p><strong>Facture émise par "Bois & Co" :</strong></p>
                <ul>
                    <li>Planches de chêne : 2 000 € HT</li>
                    <li>Port forfaitaire : 100 € HT</li>
                    <li><strong>Net commercial : 2 100 € HT</strong></li>
                    <li>TVA (20%) : 2 100 * 0,20 = 420 €</li>
                    <li>Consigne (2 palettes * 20 €) : 40 € (non soumis à TVA)</li>
                    <li><strong>Net à payer : 2 100 + 420 + 40 = 2 560 €</strong></li>
                </ul>
                <p><strong>Scénarios de retour :</strong></p>
                <p><strong>1. "Artisan du Meuble" retourne les 2 palettes :</strong> "Bois & Co" lui rembourse 40 € et annule la dette de consigne.</p>
                <p><strong>2. "Artisan du Meuble" ne retourne qu'une seule palette et garde l'autre :</strong> "Bois & Co" lui rembourse 20 € pour la palette rendue. Pour la palette non rendue, "Bois & Co" émet une facture de vente : 20 € HT + TVA 4 € = 24 € TTC. Cette somme est déduite des 20 € de consigne restants. Le solde est géré entre les deux entreprises.</p>
            `,
            exercises: [
                { id: 'q9-1', type: 'qcm', question: `Comptablement, les frais de port facturés à un client sont enregistrés dans quel type de compte ?`, options: ['Un compte de charge (Classe 6)', 'Un compte de produit (Classe 7)', 'Un compte de tiers (Classe 4)', `Un compte d'immobilisation (Classe 2)`], answer: 'Un compte de produit (Classe 7)' },
                { id: 'q9-2', type: 'cloze', question: `Une palette consignée que le client ne rend pas au fournisseur devient une _____ d'emballage.`, answer: 'vente' },
                { id: 'q9-3', type: 'textarea', question: `Pourquoi une consigne d'emballage n'est-elle pas soumise à TVA lors de la facturation initiale ?`, answer: `Parce que la consignation n'est pas une vente. C'est un prêt d'emballage contre une garantie financière. La TVA ne s'applique que sur les ventes effectives. Si l'emballage n'est pas rendu, la consigne se transforme en vente et la TVA devient alors exigible.` },
            ]
        },
        "seq10": {
            title: "Acquisitions d’immobilisations",
            course: `
                <h2>Activité 1.5 – Enregistrement et suivi des opérations relatives aux fournisseurs</h2>
                <h3>Séquence 10 - Les acquisitions d’immobilisations</h3>
                <p>Les immobilisations sont des biens (matériels, immatériels ou financiers) destinés à servir de façon durable à l'activité de l'entreprise. Leur acquisition est un investissement et non une simple charge.</p>
                <h4>1. Les différents types d'immobilisations</h4>
                <ul>
                    <li><strong>Immobilisations incorporelles :</strong> Actifs sans substance physique (fonds de commerce, droit au bail, brevets, licences, logiciels).</li>
                    <li><strong>Immobilisations corporelles :</strong> Actifs physiques (terrains, constructions, machines, matériel de transport, matériel de bureau).</li>
                    <li><strong>Immobilisations financières :</strong> Actifs de nature financière détenus durablement (titres de participation dans d'autres sociétés, prêts accordés à long terme, dépôts de garantie).</li>
                </ul>
                <h4>2. La détermination de la valeur d'une immobilisation</h4>
                <p>Une immobilisation est enregistrée à l'actif du bilan pour son <strong>coût d'acquisition</strong>. Ce coût ne se limite pas au prix d'achat.</p>
                <p><strong>Coût d'acquisition = Prix d'achat HT + Frais accessoires directement rattachables</strong></p>
                <p>Les frais accessoires incluent :</p>
                <ul>
                    <li>Les frais de transport et d'installation.</li>
                    <li>Les frais de montage.</li>
                    <li>Les droits de douane.</li>
                    <li>Les honoraires (architecte, notaire...).</li>
                </ul>
                <p>La TVA sur l'acquisition d'une immobilisation est généralement <strong>déductible</strong> et n'est donc pas incluse dans le coût d'acquisition. Elle est enregistrée en compte 44562 "TVA déductible sur immobilisations".</p>
                 <h4>3. Comptabilisation par composants</h4>
                <p>Pour les immobilisations importantes (bâtiments, avions...), la comptabilité exige une approche par composants. Chaque élément principal de l'immobilisation ayant une durée d'utilisation différente doit être comptabilisé et amorti séparément. Par exemple, pour un bâtiment, on distinguera la structure, la toiture, l'ascenseur, etc.</p>
            `,
            caseStudy: `
                <h3>Étude de Cas : Achat d'une nouvelle machine</h3>
                <p>L'entreprise "FABRICOM" achète une machine-outil pour moderniser sa production. Voici les détails de l'opération :</p>
                <ul>
                    <li>Prix d'achat de la machine : 80 000 € HT</li>
                    <li>Frais de transport payés au transporteur : 2 000 € HT</li>
                    <li>Frais d'installation et de montage réalisés par un spécialiste : 5 000 € HT</li>
                    <li>Formation du personnel à l'utilisation de la machine : 3 000 € HT</li>
                </ul>
                <p>Le taux de TVA pour toutes ces opérations est de 20%.</p>
                <p><strong>Analyse et calcul du coût d'acquisition :</strong></p>
                <p>Il faut identifier les frais qui sont directement nécessaires à la mise en service de la machine.</p>
                <ul>
                    <li>Prix d'achat : 80 000 €</li>
                    <li>Frais de transport : 2 000 € (nécessaires pour amener la machine sur site)</li>
                    <li>Frais d'installation : 5 000 € (nécessaires pour que la machine fonctionne)</li>
                </ul>
                <p>Les frais de formation (3 000 €) ne sont pas inclus dans le coût de l'immobilisation. Ils sont enregistrés comme une charge de l'exercice (compte 6333 "Formation professionnelle").</p>
                <p><strong>Coût d'acquisition de l'immobilisation = 80 000 + 2 000 + 5 000 = 87 000 €</strong></p>
                <p>Cette valeur de 87 000 € sera inscrite à l'actif du bilan. La TVA totale (sur les 87 000 € + 3 000 €) sera déductible.</p>
            `,
            exercises: [
                { id: 'q10-1', type: 'qcm', question: `Lequel de ces éléments est une immobilisation incorporelle ?`, options: ['Un camion de livraison', 'Un brevet', 'Un stock de marchandises', 'Un prêt bancaire'], answer: 'Un brevet' },
                { id: 'q10-2', type: 'cloze', question: `La TVA payée sur l'achat d'une immobilisation est généralement _____.`, answer: 'déductible' },
                { id: 'q10-3', type: 'textarea', question: `Une entreprise achète un ordinateur 1 500 € HT et un logiciel de comptabilité 500 € HT. Doit-elle enregistrer un seul ou deux types d'immobilisation ? Lesquels ?`, answer: `Elle doit enregistrer deux types d'immobilisation différents : une immobilisation corporelle (matériel de bureau) pour 1 500 € et une immobilisation incorporelle (logiciel) pour 500 €.` },
            ]
        },
        "seq11": {
            title: "Règlement à crédit",
            course: `
                <h2>Activité 1.6 – Réalisation des rapprochements bancaires</h2>
                <h3>Séquence 11 - Le règlement à crédit</h3>
                <p>Le règlement à crédit est une pratique commerciale courante où le paiement d'une transaction est différé. Pour le fournisseur, cela crée une créance ; pour le client, une dette. La gestion de ce crédit est un enjeu majeur.</p>
                <h4>1. Les enjeux du règlement à crédit</h4>
                <ul>
                    <li><strong>Pour le client (acheteur) :</strong> Obtenir un délai de paiement lui permet de financer son cycle d'exploitation. Il peut vendre la marchandise avant même de l'avoir payée, ce qui allège son besoin en fonds de roulement (BFR).</li>
                    <li><strong>Pour le fournisseur (vendeur) :</strong> Accorder un délai de paiement est un argument commercial, mais cela pèse sur sa trésorerie et crée un risque d'impayé.</li>
                </ul>
                <h4>2. Les effets de commerce</h4>
                <p>Pour formaliser et sécuriser une créance, le fournisseur peut utiliser un effet de commerce. C'est un titre négociable qui constate une créance et ordonne son paiement à une date future (l'échéance).</p>
                <ul>
                    <li><strong>La lettre de change (ou traite) :</strong> C'est un écrit par lequel le fournisseur (le <strong>tireur</strong>) donne l'ordre à son client (le <strong>tiré</strong>) de payer une certaine somme à une date donnée, soit à lui-même, soit à un tiers (le <strong>bénéficiaire</strong>, souvent une banque).</li>
                    <li><strong>Le billet à ordre :</strong> C'est un écrit par lequel le client (le <strong>souscripteur</strong>) s'engage à payer une certaine somme au fournisseur (le <strong>bénéficiaire</strong>) à une date déterminée.</li>
                </ul>
                <h4>3. La mobilisation des créances : L'escompte</h4>
                <p>Un fournisseur qui a besoin de trésorerie avant l'échéance d'un effet de commerce peut le "mobiliser", c'est-à-dire le transformer en argent immédiatement. La technique la plus courante est l'<strong>escompte</strong>.</p>
                <p><strong>Principe :</strong> Le fournisseur remet l'effet de commerce à sa banque. La banque lui verse immédiatement le montant de l'effet, après avoir déduit des frais appelés <strong>agios</strong>. Les agios comprennent les intérêts (le coût de l'avance d'argent) et des commissions.</p>
                <p><strong>Calcul de l'escompte (intérêts) :</strong> E = V x t x (n / 360)<br>
                Avec : V = Valeur nominale de l'effet, t = taux d'escompte annuel, n = nombre de jours entre la date de remise à la banque et la date d'échéance.</p>
            `,
            caseStudy: `
                <h3>Étude de Cas : L'entreprise "MECAFORM" escompte une traite</h3>
                <p>Le 15 mai, "MECAFORM" tire une lettre de change de 12 000 € sur son client "USINAGE-PLUS", payable le 31 juillet. Ayant un besoin de trésorerie, "MECAFORM" décide de la remettre à l'escompte à sa banque le 26 mai. La banque applique un taux d'escompte de 9% et une commission fixe de 15 € HT.</p>
                <p><strong>Analyse et calculs :</strong></p>
                <p><strong>1. Nombre de jours d'escompte (n) :</strong><br>
                Du 26 mai au 31 juillet.
                <ul>
                    <li>Jours en mai : 31 - 26 = 5</li>
                    <li>Jours en juin : 30</li>
                    <li>Jours en juillet : 31</li>
                </ul>
                Total n = 5 + 30 + 31 = 66 jours.</p>
                <p><strong>2. Calcul de l'escompte (intérêts) :</strong><br>
                E = 12 000 € * 9% * (66 / 360) = 198 €</p>
                <p><strong>3. Calcul des agios TTC :</strong><br>
                - Escompte : 198,00 €<br>
                - Commission HT : 15,00 €<br>
                - Total HT : 213,00 €<br>
                - TVA sur commission (20%) : 15 * 0,20 = 3,00 €<br>
                - Total des agios TTC : 213 + 3 = 216,00 €</p>
                <p><strong>4. Montant net crédité sur le compte de MECAFORM :</strong><br>
                Valeur nette = Valeur nominale - Agios TTC = 12 000 - 216 = 11 784 €.<br>
                La banque versera 11 784 € à MECAFORM le 26 mai.</p>
            `,
            exercises: [
                { id: 'q11-1', type: 'qcm', question: `Dans une lettre de change, comment s'appelle le client qui doit payer ?`, options: ['Le tireur', 'Le tiré', 'Le bénéficiaire', 'Le souscripteur'], answer: 'Le tiré' },
                { id: 'q11-2', type: 'cloze', question: `L'opération qui consiste à céder un effet de commerce à sa banque avant l'échéance pour obtenir des liquidités s'appelle l'_____.`, answer: 'escompte' },
                { id: 'q11-3', type: 'textarea', question: `Une entreprise escompte une traite de 10 000 € 60 jours avant son échéance. Le taux d'escompte est de 6%. Calculez le montant des intérêts d'escompte.`, answer: `E = V * t * (n / 360) = 10 000 * 6% * (60 / 360) = 10 000 * 0.06 * (1/6) = 100 €. Le montant des intérêts est de 100 €.` },
            ]
        },
        "seq12": {
            title: "Rapprochement bancaire",
            course: `
                <h2>Activité 1.6 – Réalisation des rapprochements bancaires</h2>
                <h3>Séquence 12 - Le rapprochement bancaire</h3>
                <p>Le rapprochement bancaire est un contrôle comptable fondamental. Il consiste à comparer les opérations enregistrées dans le compte "Banque" (512) de l'entreprise avec celles figurant sur le relevé de compte envoyé par la banque.</p>
                <h4>1. Pourquoi faire un rapprochement bancaire ?</h4>
                <p>Le solde du compte 512 dans la comptabilité de l'entreprise est presque toujours différent du solde du relevé bancaire à la même date. Cet écart est normal et s'explique par des décalages d'enregistrement.</p>
                <p><strong>Objectifs du rapprochement :</strong></p>
                <ul>
                    <li><strong>Justifier les écarts</strong> entre les deux soldes.</li>
                    <li><strong>Vérifier l'exhaustivité</strong> des enregistrements comptables (n'a-t-on rien oublié ?).</li>
                    <li><strong>Détecter des erreurs</strong> de saisie, que ce soit par l'entreprise ou par la banque.</li>
                    <li><strong>Calculer le solde de trésorerie réel</strong> et disponible.</li>
                </ul>
                <h4>2. Les causes des différences</h4>
                <p>Les différences proviennent généralement de :</p>
                <ul>
                    <li><strong>Opérations enregistrées par l'entreprise mais pas encore par la banque :</strong>
                        <ul>
                            <li>Chèques émis mais non encore débités du compte.</li>
                            <li>Remises de chèques ou d'espèces non encore créditées.</li>
                        </ul>
                    </li>
                    <li><strong>Opérations enregistrées par la banque mais pas encore par l'entreprise :</strong>
                        <ul>
                            <li>Frais bancaires (agios, commissions).</li>
                            <li>Prélèvements de fournisseurs non encore comptabilisés.</li>
                            <li>Virements de clients reçus directement sur le compte.</li>
                        </ul>
                    </li>
                </ul>
                <h4>3. La méthode du rapprochement</h4>
                <p>Le rapprochement se fait en créant un état de rapprochement, généralement à la fin de chaque mois :</p>
                <ol>
                    <li><strong>Pointer les opérations communes :</strong> On marque (pointe) toutes les opérations qui apparaissent à la fois dans le compte 512 et sur le relevé bancaire.</li>
                    <li><strong>Lister les opérations non pointées :</strong> Les opérations restantes des deux côtés sont listées sur l'état de rapprochement.</li>
                    <li><strong>Passer les écritures de régularisation :</strong> Toutes les opérations figurant sur le relevé bancaire mais absentes de la comptabilité de l'entreprise (frais, virements reçus...) doivent être immédiatement comptabilisées.</li>
                    <li><strong>Vérifier l'égalité :</strong> Après régularisation, on vérifie une égalité de contrôle : Solde comptable ajusté = Solde bancaire ajusté.</li>
                </ol>
            `,
            caseStudy: `
                <h3>Étude de Cas : Rapprochement de "Vélo-Cité" au 31 janvier</h3>
                <p>Au 31/01, la comptabilité de "Vélo-Cité" affiche un solde pour le compte 512 de <strong>4 500 €</strong>. Le relevé de la banque à la même date indique un solde de <strong>5 210 €</strong>.</p>
                <p>Après pointage, le comptable identifie les différences suivantes :</p>
                <ul>
                    <li>Un chèque de 800 € émis au fournisseur "CADRE-PLUS" le 28/01 n'a pas encore été débité par la banque.</li>
                    <li>Une remise de chèques clients de 1 500 € déposée le 30/01 n'est pas encore créditée.</li>
                    <li>Le relevé bancaire mentionne des frais de tenue de compte de 10 € que "Vélo-Cité" n'a pas encore comptabilisés.</li>
                </ul>
                <p><strong>État de Rapprochement :</strong></p>
                <table class="table-auto w-full text-left">
                    <thead><tr><th class="p-2">Solde comptable au 31/01</th><th class="p-2 text-right">4 500 €</th></tr></thead>
                    <tbody>
                        <tr><td class="p-2">- Frais bancaires à comptabiliser</td><td class="p-2 text-right">-10 €</td></tr>
                        <tr><td class="p-2 font-bold">Solde comptable après correction</td><td class="p-2 text-right font-bold">4 490 €</td></tr>
                    </tbody>
                </table>
                <table class="table-auto w-full text-left mt-4">
                    <thead><tr><th class="p-2">Solde bancaire au 31/01</th><th class="p-2 text-right">5 210 €</th></tr></thead>
                    <tbody>
                        <tr><td class="p-2">- Chèque n°123 (CADRE-PLUS) non débité</td><td class="p-2 text-right">-800 €</td></tr>
                        <tr><td class="p-2">+ Remise chèques non créditée</td><td class="p-2 text-right">+80 €</td></tr>
                        <tr><td class="p-2 font-bold">Solde bancaire rapproché</td><td class="p-2 text-right font-bold">4 490 €</td></tr>
                    </tbody>
                </table>
                <p class="mt-4"><strong>Conclusion :</strong> Les deux soldes rapprochés sont égaux. Le rapprochement est correct. L'entreprise doit maintenant passer l'écriture pour les 10 € de frais bancaires.</p>
            `,
            exercises: [
                { id: 'q12-1', type: 'qcm', question: `Lequel de ces éléments est une opération enregistrée par l'entreprise mais souvent pas encore par la banque ?`, options: ['Frais bancaires', `Un virement reçu d'un client`, 'Un chèque émis à un fournisseur', 'Un prélèvement automatique'], answer: 'Un chèque émis à un fournisseur' },
                { id: 'q12-2', type: 'cloze', question: `Les opérations qui apparaissent sur le relevé bancaire mais pas en comptabilité doivent faire l'objet d'écritures de _____.`, answer: 'régularisation' },
                { id: 'q12-3', type: 'textarea', question: `Votre solde comptable est de 1000 €. Votre solde bancaire est de 1200 €. Vous avez émis un chèque de 200 € qui n'a pas encore été débité. Le rapprochement est-il correct ? Justifiez.`, answer: `Oui, le rapprochement est correct. Le solde bancaire rapproché est de 1200 € - 200 € = 1000 €, ce qui est égal au solde comptable. L'écart de 200 € est justifié par le chèque en circulation.` },
            ]
        },
        "seq13": {
            title: "Analyse des comptes de tiers",
            course: `
                <h2>Activité 1.6 – Réalisation des rapprochements bancaires</h2>
                <h3>Séquence 13 - L’analyse des comptes de tiers</h3>
                <p>L'analyse des comptes de tiers (clients et fournisseurs) est une démarche proactive qui permet d'évaluer la santé financière des relations commerciales, d'anticiper les risques et d'optimiser la gestion de la trésorerie.</p>
                <h4>1. Objectifs de l'analyse</h4>
                <ul>
                    <li><strong>Expliquer le niveau de la trésorerie :</strong> Les délais de paiement accordés aux clients (crédit client) et obtenus des fournisseurs (crédit fournisseur) ont un impact direct sur le Besoin en Fonds de Roulement (BFR) et donc sur la trésorerie.</li>
                    <li><strong>Prévenir les incidents de paiement :</strong> Analyser le comportement de paiement des clients permet d'identifier les risques d'impayés et de mettre en place des actions préventives.</li>
                    <li><strong>Surveiller et négocier les clauses commerciales :</strong> Suivre les délais de règlement permet de vérifier si les conditions négociées sont respectées et d'identifier des leviers de négociation futurs.</li>
                </ul>
                <h4>2. Instruments d'analyse</h4>
                <ul>
                    <li><strong>La Balance âgée :</strong> (Vue en Séquence 7) C'est l'outil principal pour visualiser les retards de paiement des clients et hiérarchiser les actions de relance.</li>
                    <li><strong>Le délai moyen de règlement :</strong>
                        <ul>
                            <li><strong>Délai de règlement clients (DSO - Days Sales Outstanding) :</strong> Il mesure le nombre de jours de chiffre d'affaires qui sont en attente d'encaissement.<br><em>Formule : (Créances clients TTC / Chiffre d'affaires TTC) * 360 jours.</em><br>Un DSO élevé signifie que les clients paient lentement, ce qui pèse sur la trésorerie.</li>
                            <li><strong>Délai de règlement fournisseurs (DPO - Days Payable Outstanding) :</strong> Il mesure le nombre de jours d'achats que l'entreprise met à payer.<br><em>Formule : (Dettes fournisseurs TTC / Achats TTC) * 360 jours.</em><br>Un DPO élevé signifie que l'entreprise paie lentement ses fournisseurs, ce qui est favorable à sa trésorerie (crédit fournisseur gratuit).</li>
                        </ul>
                    </li>
                </ul>
                <p>L'objectif pour une entreprise est souvent de réduire son DSO et d'augmenter son DPO, tout en respectant les délais légaux et en maintenant de bonnes relations commerciales.</p>
            `,
            caseStudy: `
                <h3>Étude de Cas : Analyse du BFR de "Solutions PC"</h3>
                <p>"Solutions PC" a réalisé sur l'année un chiffre d'affaires de 960 000 € TTC et des achats de 600 000 € TTC. À la fin de l'année, ses créances clients s'élèvent à 120 000 € et ses dettes fournisseurs à 75 000 €.</p>
                <p><strong>Calcul des délais moyens :</strong></p>
                <p><strong>1. DSO (Délai clients) :</strong><br>
                DSO = (120 000 / 960 000) * 360 = <strong>45 jours</strong>.<br>
                En moyenne, "Solutions PC" met 45 jours pour encaisser ses factures clients.</p>
                <p><strong>2. DPO (Délai fournisseurs) :</strong><br>
                DPO = (75 000 / 600 000) * 360 = <strong>45 jours</strong>.<br>
                En moyenne, "Solutions PC" paie ses fournisseurs sous 45 jours.</p>
                <p><strong>Analyse :</strong> Le cycle de financement est neutre. L'entreprise paie ses fournisseurs dans le même délai qu'elle est payée par ses clients. Si son DSO passait à 60 jours (clients plus lents) et son DPO restait à 45 jours, elle devrait trouver 15 jours de financement pour son cycle d'exploitation, ce qui augmenterait son BFR.</p>
            `,
            exercises: [
                { id: 'q13-1', type: 'qcm', question: `Un DSO élevé est généralement :`, options: ['Favorable pour la trésorerie', 'Défavorable pour la trésorerie', 'Sans impact sur la trésorerie', 'Un signe de bonne gestion client'], answer: 'Défavorable pour la trésorerie' },
                { id: 'q13-2', type: 'cloze', question: `Le ratio qui mesure le délai de paiement des fournisseurs est le _____.`, answer: 'DPO' },
                { id: 'q13-3', type: 'textarea', question: `Une entreprise a un CA TTC de 500 000 € et des créances clients de 50 000 €. Calculez son DSO et interprétez le résultat.`, answer: `DSO = (50 000 / 500 000) * 360 = 36 jours. Cela signifie qu'en moyenne, l'entreprise met 36 jours pour être payée par ses clients.` },
            ]
        },
        "seq14": {
            title: "Contrôle interne",
            course: `
                <h2>Activité 1.7 – Contribution à la performance et la sécurisation des opérations</h2>
                <h3>Séquence 14 - Le contrôle interne du processus de gestion comptable</h3>
                <p>Le contrôle interne est l'ensemble des sécurités mises en place par une entreprise pour maîtriser ses activités. Il ne s'agit pas seulement de "contrôler" au sens de "vérifier", mais de s'assurer que l'organisation fonctionne comme prévu et atteint ses objectifs de manière efficace et sécurisée.</p>
                <h4>1. Les objectifs du contrôle interne</h4>
                <p>Le contrôle interne vise principalement à garantir :</p>
                <ul>
                    <li><strong>La sauvegarde des actifs :</strong> Protéger le patrimoine de l'entreprise contre les pertes, le gaspillage, les vols ou les fraudes.</li>
                    <li><strong>La qualité et la fiabilité des informations :</strong> S'assurer que les informations (notamment comptables et financières) sont exactes, complètes et disponibles à temps.</li>
                    <li><strong>Le respect des lois et réglementations :</strong> Veiller à ce que l'entreprise se conforme à toutes les obligations légales, fiscales et sociales.</li>
                    <li><strong>L'optimisation des processus :</strong> Améliorer l'efficacité et l'efficience des opérations.</li>
                </ul>
                <h4>2. Les moyens du contrôle interne</h4>
                <p>Le contrôle interne s'appuie sur des dispositifs concrets :</p>
                <ul>
                    <li><strong>Une organisation claire :</strong> Définition des responsabilités et des pouvoirs de chacun (organigramme, fiches de poste).</li>
                    <li><strong>La séparation des tâches :</strong> C'est un principe fondamental. Les tâches clés doivent être réparties entre plusieurs personnes pour éviter qu'un seul individu ait le contrôle total sur une opération du début à la fin. Par exemple, la personne qui passe une commande ne doit pas être la même que celle qui la réceptionne et celle qui autorise le paiement.</li>
                    <li><strong>Des procédures formalisées :</strong> Des modes opératoires écrits qui décrivent "qui fait quoi, quand et comment" (ex: procédure d'engagement des dépenses, procédure de validation des factures).</li>
                    <li><strong>La supervision :</strong> La vérification du travail par un supérieur hiérarchique.</li>
                    <li><strong>Des systèmes d'information sécurisés :</strong> Contrôle des accès aux logiciels, sauvegardes régulières des données, pistes d'audit pour tracer les modifications.</li>
                </ul>
            `,
            caseStudy: `
                <h3>Étude de Cas : Fraude à la commande chez "Petit Bazar"</h3>
                <p>"Petit Bazar" est une petite entreprise où la même personne, M. Martin, est responsable des achats, de la réception des marchandises et de la validation des paiements fournisseurs. Un jour, un audit révèle des paiements à un fournisseur inconnu pour des marchandises jamais reçues.</p>
                <p><strong>Analyse du problème :</strong></p>
                <p>La fraude a été rendue possible par une absence totale de <strong>séparation des tâches</strong>. M. Martin pouvait créer un faux fournisseur, passer une fausse commande, simuler la réception et autoriser le paiement sur un compte bancaire qu'il contrôlait.</p>
                <p><strong>Mise en place de mesures de contrôle interne :</strong></p>
                <ol>
                    <li><strong>Nouvelle organisation :</strong>
                        <ul>
                            <li>Les commandes sont désormais passées par le service achats.</li>
                            <li>La réception est effectuée par le service logistique, qui vérifie la conformité avec le bon de commande.</li>
                            <li>La comptabilité ne paie une facture que si elle correspond au bon de commande ET au bon de réception validé.</li>
                        </ul>
                    </li>
                    <li><strong>Procédure écrite :</strong> Une nouvelle procédure "Achats-Fournisseurs" est rédigée et diffusée, détaillant ces étapes.</li>
                    <li><strong>Contrôle informatique :</strong> Le PGI est configuré pour bloquer le paiement d'une facture si les quantités facturées ne correspondent pas aux quantités réceptionnées.</li>
                </ol>
                <p>Ces mesures, basées sur la séparation des tâches et la formalisation, rendent ce type de fraude beaucoup plus difficile.</p>
            `,
            exercises: [
                { id: 'q14-1', type: 'qcm', question: `Lequel de ces principes est fondamental en contrôle interne ?`, options: ['La concentration des pouvoirs', 'La séparation des tâches', `L'absence de procédures`, `La confiance aveugle`], answer: 'La séparation des tâches' },
                { id: 'q14-2', type: 'cloze', question: `Protéger l'entreprise contre le vol ou la fraude est un objectif de ____ des actifs.`, answer: 'sauvegarde' },
                { id: 'q14-3', type: 'textarea', question: `Donnez un exemple simple de contrôle interne dans le processus de vente pour s'assurer que toutes les livraisons sont bien facturées.`, answer: `Un exemple serait un rapprochement périodique (quotidien ou hebdomadaire) entre la liste des bons de livraison émis et la liste des factures de vente créées. Toute livraison sans facture correspondante doit générer une alerte pour investigation et facturation.` },
            ]
        },
        "atelier-html": {
            title: "Atelier HTML Interactif",
            course: `
                <h2>Atelier de création HTML avec l'IA</h2>
                <p>Cet onglet est un espace créatif où vous pouvez demander à l'IA de générer des éléments HTML pour vous aider dans vos révisions. Décrivez simplement ce que vous voulez en langage naturel dans la zone de texte ci-dessous.</p>
                <h3>Exemples de commandes :</h3>
                <ul>
                    <li>"Crée un tableau avec les 5 principes comptables fondamentaux et une brève description pour chacun."</li>
                    <li>"Génère une liste à puces des mentions obligatoires sur une facture."</li>
                    <li>"Fais-moi une carte mentale (mind map) simple sur les différents types de partenaires d'une entreprise."</li>
                    <li>"Crée une chronologie des étapes du processus d'achat."</li>
                </ul>
                <p>L'IA utilisera Tailwind CSS pour la mise en forme. Soyez aussi précis que possible pour obtenir le meilleur résultat !</p>
            `,
            caseStudy: ``,
            exercises: []
        },
    };
    
    // Ajouter les autres séquences vides pour la navigation
    const allSequences = ["seq0", "seq1", "seq2", "seq3", "seq4", "seq5", "seq6", "seq7", "seq8", "seq9", "seq10", "seq11", "seq12", "seq13", "seq14", "atelier-html"];
    const sequenceTitles = {
        "seq0": "Conseils généraux", "seq1": "Les acteurs de l’entreprise", "seq2": "Le SIC", "seq3": "L’information de synthèse", 
        "seq4": "Traitement de l’information", "seq5": "Normalisation comptable", "seq6": "Opérations d’achat et vente", 
        "seq7": "Suivi clients et fournisseurs", "seq8": "TVA sur opérations particulières", "seq9": "Frais accessoires", 
        "seq10": "Acquisitions d’immobilisations", "seq11": "Règlement à crédit", "seq12": "Rapprochement bancaire", 
        "seq13": "Analyse des comptes de tiers", "seq14": "Contrôle interne", "atelier-html": "Atelier HTML"
    };

    allSequences.forEach(seqId => {
        if (!syllabusData[seqId]) {
            syllabusData[seqId] = {
                title: sequenceTitles[seqId] || `Séquence ${seqId.replace('seq', '')}`,
                course: `<p class="text-center text-gray-400 italic">Contenu pour cette séquence à venir.</p>`,
                caseStudy: ``,
                exercises: []
            };
        }
    });


    // --- LOGIQUE DE L'APPLICATION ---
    document.addEventListener('DOMContentLoaded', () => {
        const tabNavigation = document.getElementById('tab-navigation');
        const tabContent = document.getElementById('tab-content');
        let currentSequenceId = 'seq0';

        function renderTabs() {
            tabNavigation.innerHTML = '';
            allSequences.forEach(seqId => {
                const data = syllabusData[seqId];
                if (data) {
                    const button = document.createElement('button');
                    button.className = `tab-button text-white font-medium py-2 px-4 rounded-lg`;
                    button.textContent = data.title;
                    button.dataset.sequenceId = seqId;
                    if (seqId === currentSequenceId) {
                        button.classList.add('active');
                    }
                    tabNavigation.appendChild(button);
                }
            });
        }
        
        function renderContent(sequenceId) {
            currentSequenceId = sequenceId;
            const data = syllabusData[sequenceId];
            if (!data) return;

            let exercisesHtml = '';
            if (data.exercises.length > 0) {
                exercisesHtml = `
                    <div class="mt-8 pt-6 border-t border-white/20">
                        <h3 class="text-2xl font-semibold mb-4">Exercices d'application</h3>
                        ${data.exercises.map((ex, index) => `
                            <div class="mb-6" id="exercise-${ex.id}">
                                <p class="font-semibold mb-2">${index + 1}. ${ex.question}</p>
                                ${renderExerciseInput(ex)}
                            </div>
                        `).join('')}
                        <button class="glass-button text-white font-bold py-2 px-4 rounded-lg mt-4" onclick="corrigerParIA('${sequenceId}')">Soumettre & Corriger par IA</button>
                        <div id="loader-${sequenceId}" class="mt-4 hidden">
                           <div class="flex items-center gap-2 text-sm text-white/70">
                                 <div class="loader !w-6 !h-6 !border-2"></div>
                                 <span>Correction en cours par l'IA...</span>
                            </div>
                        </div>
                        <div id="feedback-${sequenceId}" class="ai-feedback mt-4 p-4 rounded-lg prose prose-invert max-w-none"></div>
                    </div>
                `;
            }

            let atelierHtml = '';
            if(sequenceId === 'atelier-html') {
                atelierHtml = `
                    <div class="mt-6">
                         <h3 class="text-2xl font-semibold mb-4">Votre requête en langage naturel :</h3>
                        <textarea id="html-prompt" class="w-full h-32 bg-white/10 border border-white/30 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-white/50 text-white placeholder-white/50" placeholder="Ex: Crée un tableau comparatif des 3 types de réductions commerciales..."></textarea>
                        <button id="generate-html-btn" class="glass-button text-white font-bold py-2 px-4 rounded-lg mt-4">Générer l'élément HTML</button>
                        <div id="html-loader" class="mt-4 hidden">
                             <div class="flex items-center gap-2 text-sm text-white/70">
                                 <div class="loader !w-6 !h-6 !border-2"></div>
                                 <span>L'IA construit votre élément HTML...</span>
                            </div>
                        </div>
                        <h3 class="text-2xl font-semibold mt-8 mb-4">Prévisualisation :</h3>
                        <div class="bg-white/5 p-4 rounded-lg min-h-[200px] border border-white/20">
                            <iframe id="html-preview" class="w-full h-full min-h-[200px] border-0 bg-transparent" srcdoc="<p class='text-center text-gray-400'>L'aperçu apparaîtra ici.</p>"></iframe>
                        </div>
                    </div>
                `;
            }

            tabContent.innerHTML = `
                <div class="prose prose-invert max-w-none">
                    ${data.course}
                    ${data.caseStudy ? `
                        <div class="mt-8 pt-6 border-t border-white/20">
                            <h3 class="text-2xl font-semibold mb-4">Étude de Cas</h3>
                            ${data.caseStudy}
                        </div>
                    ` : ''}
                </div>
                ${exercisesHtml}
                ${atelierHtml}
            `;

            // Ajout des listeners pour l'atelier
            if (sequenceId === 'atelier-html') {
                document.getElementById('generate-html-btn').addEventListener('click', generateHtmlElement);
            }

            // Mettre à jour le bouton actif
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.sequenceId === sequenceId);
            });
        }
        
        function renderExerciseInput(ex) {
            switch (ex.type) {
                case 'qcm':
                    return ex.options.map(opt => `
                        <label class="flex items-center mb-2">
                            <input type="radio" name="${ex.id}" value="${opt}" class="mr-2">
                            <span>${opt}</span>
                        </label>
                    `).join('');
                case 'cloze':
                    return `<input type="text" id="answer-${ex.id}" class="w-full md:w-1/2 bg-white/10 border border-white/30 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-white/50 text-white">`;
                case 'textarea':
                    return `<textarea id="answer-${ex.id}" rows="4" class="w-full bg-white/10 border border-white/30 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-white/50 text-white"></textarea>`;
                default:
                     return `<input type="text" id="answer-${ex.id}" class="w-full md:w-1/2 bg-white/10 border border-white/30 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-white/50 text-white">`;
            }
        }
        
        // --- LOGIQUE API ---
        async function callGemini(prompt, systemInstruction = null) {
            try {
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                };
                if (systemInstruction) {
                    payload.systemInstruction = { parts: [{ text: systemInstruction }] };
                }

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`Erreur API: ${response.status} ${response.statusText}. Détails: ${errorBody}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                     // Check for safety ratings block
                    if (data.candidates && data.candidates[0] && data.candidates[0].finishReason === 'SAFETY') {
                        return "Désolé, la réponse a été bloquée car elle ne respecte pas les consignes de sécurité. Veuillez reformuler votre demande.";
                    }
                    throw new Error('Réponse inattendue de l\'API Gemini.');
                }
            } catch (error) {
                console.error("Erreur lors de l'appel à l'API Gemini:", error);
                return `Une erreur est survenue. Détails : ${error.message}`;
            }
        }

        window.corrigerParIA = async (sequenceId) => {
            const sequenceData = syllabusData[sequenceId];
            if (!sequenceData || !sequenceData.exercises) return;

            const loader = document.getElementById(`loader-${sequenceId}`);
            const feedbackDiv = document.getElementById(`feedback-${sequenceId}`);
            loader.style.display = 'block';
            feedbackDiv.innerHTML = '';
            
            let userAnswers = [];
            sequenceData.exercises.forEach(ex => {
                let answer;
                if (ex.type === 'qcm') {
                    const checked = document.querySelector(`input[name="${ex.id}"]:checked`);
                    answer = checked ? checked.value : 'Aucune réponse';
                } else {
                    const input = document.getElementById(`answer-${ex.id}`);
                    answer = input ? input.value : 'Aucune réponse';
                }
                userAnswers.push({
                    question: ex.question,
                    userAnswer: answer,
                    correctAnswer: ex.answer
                });
            });

            const systemPrompt = `
                Tu es un tuteur expert en comptabilité pour des étudiants de niveau BTS. 
                Ton rôle est de corriger les exercices soumis. Pour chaque question :
                1. Indique si la réponse de l'étudiant est "Correcte" ou "Incorrecte".
                2. Si la réponse est incorrecte ou incomplète, fournis une explication claire, pédagogique et concise de la bonne réponse.
                3. Donne des conseils spécifiques pour que l'étudiant s'améliore, surtout dans un contexte d'examen.
                4. Sois encourageant et professionnel. Utilise le format Markdown pour structurer ta réponse (titres, listes, gras).
            `;
            
            const userPrompt = `
                Voici les réponses d'un étudiant pour la séquence "${sequenceData.title}". Merci de les corriger.
                ${userAnswers.map((a, i) => `
                ---
                **Exercice ${i + 1} :**
                *Question :* ${a.question}
                *Réponse de l'étudiant :* ${a.userAnswer}
                `).join('\n')}
            `;
            
            const feedbackText = await callGemini(userPrompt, systemPrompt);
            feedbackDiv.innerHTML = marked.parse(feedbackText);
            loader.style.display = 'none';
        };

        async function generateHtmlElement() {
            const promptInput = document.getElementById('html-prompt');
            const previewFrame = document.getElementById('html-preview');
            const loader = document.getElementById('html-loader');

            if (!promptInput.value.trim()) {
                previewFrame.srcdoc = `<p class="text-center text-red-400">Veuillez entrer une description.</p>`;
                return;
            }
            
            loader.style.display = 'block';
            previewFrame.srcdoc = '';

            const systemPrompt = `
                Tu es un générateur de code HTML expert. 
                Ta mission est de générer UNIQUEMENT le code HTML et CSS correspondant à la demande de l'utilisateur.
                - Utilise impérativement les classes de Tailwind CSS pour toute la mise en forme. Ne génère PAS de balise <style> ni de CSS en ligne.
                - Le code doit être propre, sémantique et bien structuré.
                - Le code généré sera inséré dans un conteneur sombre avec un fond de type "glassmorphism", donc utilise des couleurs de texte claires (ex: text-white, text-gray-200) pour garantir un bon contraste.
                - Ne génère pas les balises <html>, <head> ou <body>. Génère uniquement le fragment de code HTML demandé.
                - N'ajoute aucun commentaire, explication ou texte en dehors du bloc de code. Ta réponse doit commencer par \`\`\`html et finir par \`\`\`.
            `;
            
            const userPrompt = `Génère le code HTML pour : "${promptInput.value}".`;
            
            let htmlCode = await callGemini(userPrompt, systemPrompt);
            
            // Nettoyage de la réponse de l'IA pour ne garder que le code
            if (htmlCode.startsWith('```html')) {
                htmlCode = htmlCode.substring(7);
            }
            if (htmlCode.endsWith('```')) {
                htmlCode = htmlCode.slice(0, -3);
            }

            // Ajout du script Tailwind et du style de base à l'iframe pour le rendu
            const fullHtml = `
                <head>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <style>
                        body { 
                            background-color: transparent;
                            color: white; 
                            font-family: 'Inter', sans-serif;
                            padding: 1rem;
                        }
                    </style>
                </head>
                <body>
                    ${htmlCode.trim()}
                </body>
            `;
            
            previewFrame.srcdoc = fullHtml;
            loader.style.display = 'none';
        }

        // --- GESTION DU TUTEUR IA MODAL ---
        const openAiTutorBtn = document.getElementById('openAiTutorBtn');
        const closeAiTutorBtn = document.getElementById('closeAiTutorBtn');
        const aiTutorModal = document.getElementById('aiTutorModal');
        const sendChatBtn = document.getElementById('send-chat-btn');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');
        const chatLoader = document.getElementById('chat-loader');

        openAiTutorBtn.addEventListener('click', () => {
            aiTutorModal.classList.remove('hidden');
            setTimeout(() => aiTutorModal.classList.remove('opacity-0'), 10); // Pour la transition
        });

        closeAiTutorBtn.addEventListener('click', () => {
            aiTutorModal.classList.add('opacity-0');
            setTimeout(() => aiTutorModal.classList.add('hidden'), 300);
        });
        
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        sendChatBtn.addEventListener('click', sendChatMessage);

        async function sendChatMessage() {
            const userQuery = chatInput.value.trim();
            if (!userQuery) return;

            // Afficher le message de l'utilisateur
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = "p-3 rounded-lg mb-2 text-right";
            userMessageDiv.innerHTML = `<span class="bg-blue-600/50 p-2 rounded-lg inline-block">${userQuery}</span>`;
            chatMessages.appendChild(userMessageDiv);
            
            chatInput.value = '';
            chatLoader.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            const sequenceData = syllabusData[currentSequenceId];
            const context = `
                **Contexte du cours actuel :**
                *Titre de la séquence :* ${sequenceData.title}
                *Contenu du cours :*
                ${sequenceData.course}
                *Étude de cas :*
                ${sequenceData.caseStudy}
                *Énoncés des exercices :*
                ${sequenceData.exercises.map(e => `- ${e.question}`).join('\n')}
            `;

            const systemPrompt = `
                Tu es un tuteur IA spécialisé en comptabilité pour des étudiants de BTS. 
                Tu réponds aux questions de l'étudiant en te basant STRICTEMENT sur le contexte de la séquence de cours fournie. 
                Sois clair, concis, pédagogique et encourageant.
                Réponds en format Markdown.
                Si la question sort du contexte fourni, réponds poliment que tu ne peux aider que sur la séquence actuelle.
            `;
            const fullPrompt = `${context}\n\n**Question de l'étudiant :**\n${userQuery}`;

            const aiResponse = await callGemini(fullPrompt, systemPrompt);
            
            chatLoader.style.display = 'none';

            const aiMessageDiv = document.createElement('div');
            aiMessageDiv.className = "chat-message p-3 rounded-lg mb-2 text-white/90";
            aiMessageDiv.innerHTML = marked.parse(aiResponse);
            chatMessages.appendChild(aiMessageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }


        // --- INITIALISATION ---
        tabNavigation.addEventListener('click', (e) => {
            if (e.target.matches('.tab-button')) {
                renderContent(e.target.dataset.sequenceId);
            }
        });
        
        renderTabs();
        renderContent(currentSequenceId);
    });
    </script>

</body>
</html>